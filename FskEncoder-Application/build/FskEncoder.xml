<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<project default="build all" name="FskEncoder">

	<include file="../ApplicationBuildSupport.xml" />
	
	<property name="targetName" 		value="${ant.project.name}" />
	
	<property name="app.dir.scriptsRepo"	value="${app.dir.defaultsRepo}/${targetName}/scripts" />
	<property name="app.dir.configRepo"		value="${app.dir.defaultsRepo}/${targetName}/cfg" />

	<property name="stream" value="0"/>
	
	<property name="version" value="${main.line}.${stream}"/>

	<buildnumber file="${app.dir.defaultsRepo}/${targetName}/build.number"/>
	<property name="build" value="${build.number}" />
	
	<property name="release" value ="${version}.${build}" />

	
	<target name="build all">
		
		<tstamp>
			<format property="current.time" pattern="yyyy.MM.dd HH:mm:ss" />
		</tstamp>

		<echo message="Building version ${release} at ${current.time}" />      
		
		<antcall target="${targetName}" />				
		<antcall target="copy config" />
		<antcall target="Extension jar" />

	</target>
	
	
	<target name="FskEncoder">
		
		<echo message="release: ${release}" />
		
		<replaceFile sourcepath="${app.dir.scriptsRepo}" destPath="${dir.dist}/bin/" fileName="${targetName}.bat" />
		<replaceFile sourcepath="${app.dir.scriptsRepo}" destPath="${dir.dist}/bin/" fileName="${targetName}-all.bat" />

		<mkManifest 
			location="${app.dir.defaultsRepo}/${targetName}" 
			version="${release}" 
			timestamp="${current.time}" 
		/>
		
		<delete file="${dir.dist}/${targetName}.jar" />
		
        <jar destfile="${dir.dist}/bin/${targetName}.jar"
			basedir="${app.dir.classesRoot}"
			excludes="source/bin/**/* source/ihx/**/* target/**/*"
			manifest="${app.dir.defaultsRepo}/${targetName}/MANIFEST.MF"
    		>
        	
        </jar>

		<delete file="${dir.dist}/${targetName}Extension.jar" />
		
        <jar destfile="${dir.dist}/bin/${targetName}Extension.jar"
			basedir="${app.dir.classesRoot}"
			includes="extension/**"
			manifest="${app.dir.defaultsRepo}/${targetName}/MANIFEST.MF"
    		>
        	
        </jar>

		<replaceLibrary sourcepath="${app.dir.mavenRepo}/com/miglayout/miglayout/3.7.4/"				fileName="miglayout-3.7.4.jar"/>
		<replaceLibrary sourcepath="${app.dir.mavenRepo}/org/apache/logging/log4j/log4j-api/2.11.2/"	fileName="log4j-api-2.11.2.jar"/>
		<replaceLibrary sourcepath="${app.dir.mavenRepo}/org/apache/logging/log4j/log4j-core/2.11.2/"	fileName="log4j-core-2.11.2.jar"/>
		<replaceLibrary sourcepath="${app.dir.mavenRepo}/args4j/args4j/2.37/"							fileName="args4j-2.37.jar"/>
		<!-- replaceLibrary sourcepath="${app.dir.mavenRepo}/io/github/classgraph/classgraph/4.8.184/"		fileName="classgraph-4.8.184.jar"/ -->

	</target>
	
	<target name="copy config" >
		
		<echo message="release: ${release}" />

		<replaceConfig sourcePath="${app.dir.configRepo}" fileName="Empty.properties" />
		<replaceConfig sourcePath="${app.dir.configRepo}" fileName="Plugin.properties" />
		<replaceConfig sourcePath="${app.dir.configRepo}" fileName="FskEncoder.properties" />
		<replaceConfig sourcePath="${app.dir.configRepo}" fileName="log4j2.xml" />

	</target>
	
	
	<target name="pack application">
	
		<echo message="release: ${release}" />

		<delete file="${dir.dist}/${targetName}.zip" failonerror="no" />
		
		<zip destfile="${dir.dist}/${targetName}.zip"
			basedir="${dir.dist}"
			includes="bin/* cfg/Empty.properties lib/"
		/>
		
	</target>
	
	
	<target name="Extension jar">
		
		<echo message="release: ${release}" />

		<property name="extensionName" value="${targetName}Extension-${release}.jar" />
		<property name="dir.extension" value="${app.dir.projectRoot}/target/tmp" />
	
		<mkManifest 
			location="${app.dir.defaultsRepo}/${targetName}" 
			version="${release}" 
			timestamp="${current.time}" 
		/>
		
		<delete file="${dir.dist}/${extensionName}" failonerror="no" />
		
		<delete dir="${dir.extension}" failonerror="no" />
		<mkdir dir="${dir.extension}" />
		
		<copydir src="${app.dir.classesRoot}/extension" dest="${dir.extension}/extension" />
		<copydir src="${app.dir.sourceRoot}/extension"  dest="${dir.extension}/extension" />
		
        <jar destfile="${dir.dist}/bin/${extensionName}"
			basedir="${dir.extension}"
			manifest="${app.dir.defaultsRepo}/${targetName}/MANIFEST.MF"
    		>
        	
        </jar>

	</target>
	
	
	
	<target name="Extension javadoc">
		
		<echo message="release: ${release}" />

		<property name="dir.log4j" value="C:/Users/Stefan/.m2/repository/org/apache/logging/log4j" />

		<echo message="app.dir.sourceRoot = ${app.dir.sourceRoot}" />
		<echo message="app.dir.docRoot    = ${app.dir.docRoot}" />
		<echo message="dir.log4j          = ${dir.log4j}" />

		<delete dir="${app.dir.docRoot}/extension" failonerror="no" />
		
		<javadoc 
			packagenames="extension.*" 
			sourcepath="${app.dir.sourceRoot}"
			destdir="${app.dir.docRoot}/extension" 
			version="true"
			defaultexcludes="yes"
			excludepackagenames="org.*"
			windowtitle="Fsk Encoder Extensions"
		>
	
			<classpath>
				<fileset dir="${dir.log4j}/log4j-api/2.11.2">
					<include name="*.jar"/>
				</fileset>
				<fileset dir="${dir.log4j}/log4j-core/2.11.2">
					<include name="*.jar"/>
				</fileset>
			</classpath>

			<doctitle><![CDATA[Fsk Encoder Extension Interface r${release}]]></doctitle>
			<bottom>
			<![CDATA[Copyright 2025. All Rights Reserved.]]>
			</bottom>
			
		</javadoc>
	
		<echo message="java doc has been generated!" />

	</target>
	

</project>
